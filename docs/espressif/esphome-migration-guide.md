# ESPHome 指南

ESPHome可以在不同平台上安装，其主要依赖Python和Platform IO来解析和创建工程，编译和上传固件。

<svg width="120" viewBox="0 0 1194 240" class="text-gray-800 dark:text-gray-200 fill-current"><g class="casita"><path d="M240 219C240 227.24 233.24 234 225 234H15C6.76 234 0 227.24.0 219V129c0-8.24 4.78-19.78 10.6-25.6L109.4 4.61999c5.83999999999999-5.84 15.38-5.84 21.22.0L229.4 103.4C235.24 109.24 240 120.76 240 129v90z"></path><path fill="#FFF" d="M160 78.66H80C76.68 78.66 74 81.34 74 84.66V234H86V90.66h68v12H104C100.68 102.66 98 105.34 98 108.66v24C98 135.98 100.68 138.66 104 138.66h50v12H104C100.68 150.66 98 153.34 98 156.66v24C98 183.98 100.68 186.66 104 186.66h50v12H104C100.68 198.66 98 201.34 98 204.66s2.68000000000001 6 6 6h56C163.32 210.66 166 207.98 166 204.66v-24C166 177.34 163.32 174.66 160 174.66H110v-12h50C163.32 162.66 166 159.98 166 156.66v-24C166 129.34 163.32 126.66 160 126.66H110v-12h50C163.32 114.66 166 111.98 166 108.66v-24C166 81.34 163.32 78.66 160 78.66z"></path></g><g class="text"><path d="M423 167.61v22.5H336V49.95h87V72.63H359.82v36.28h56.44v21.1H359.82v37.6H423z"></path><path d="M491.08 47.41c12.82.0 23.46 3.12 31.96 9.38C531.54 63.03 536.76 71.39 538.7 81.83L516.3 87.93C515.04 81.93 512.12 77.31 507.54 74.05 502.94 70.81 497.28 69.17 490.52 69.17 483.26 69.17 477.52 70.91 473.28 74.37 469.02 77.83 466.9 82.45 466.9 88.19c0 9.06 5.62 14.94 16.88 17.62L506.66 111.53c11.82 3.06 20.66 7.92 26.54 14.58C539.08 132.77 542.02 140.97 542.02 150.71c0 12.5-4.53999999999996 22.6-13.6 30.32C519.36 188.75 507.24 192.61 492.04 192.61 478.36 192.61 466.78 189.39 457.36 182.95 448.04 176.27 442.54 167.45 440.86 156.51L463.26 150.69C464.08 156.87 467.16 161.73 472.5 165.23S484.64 170.47 492.9 170.47C501.16 170.47 507.08 168.79 511.6 165.45 516.14 162.11 518.4 157.57 518.4 151.81c0-9-5.62-14.94-16.88-17.82L478.64 128.45C466.88 125.77 458.06 120.99 452.16 114.15 446.26 107.31 443.3 98.95 443.3 89.07 443.3 76.69 447.7 66.65 456.48 58.93 465.26 51.21 476.8 47.35 491.12 47.35L491.08 47.41z"></path><path d="M666.1 95.61C666.1 109.37 661.92 120.49 653.58 128.99 645.24 137.49 634 141.75 619.88 141.75h-31.5v48.38H564.56V49.95h55.5c14.24.0 25.48 4.12 33.7 12.32C661.98 70.49 666.08 81.59 666.08 95.59L666.1 95.61zM641.16 95.05C641.16 87.99 638.96 82.25 634.56 77.85 630.16 73.45 623.92 71.25 615.86 71.25H588.4v49.6h27.1C623.74 120.85 630.1 118.51 634.54 113.81 638.98 109.13 641.2 102.87 641.2 95.05H641.16z"></path><path d="M687.38 49.95H711.2v58.6L772.98 108.73V49.95h24V190.11h-24V129.83L711.2 129.65v60.46H687.38V49.95z"></path><path d="M868.6 92.79C883.1 92.79 894.92 97.45 904.04 106.75 913.16 116.07 917.72 128.03 917.72 142.65S913.16 169.15 904.04 178.47 883.1 192.43 868.6 192.43s-26.5-4.66-35.62-13.96C823.86 169.15 819.3 157.23 819.3 142.65 819.3 128.07 823.86 115.97 832.98 106.69s21-13.92 35.62-13.92V92.79zm0 79.22C876.34 172.01 882.64 169.27 887.5 163.81 892.34 158.35 894.76 151.23 894.76 142.49 894.76 133.75 892.34 126.67 887.5 121.25 882.66 115.85 876.36 113.15 868.6 113.15S854.26 115.85 849.38 121.25 842.06 133.73 842.06 142.49C842.06 151.25 844.5 158.35 849.38 163.81S860.66 172.01 868.6 172.01z"></path><path d="M1081.6 129.83v60.28h-22.04V133.29C1059.56 126.73 1057.88 121.61 1054.5 117.91 1051.12 114.23 1046.54 112.37 1040.72 112.37 1034.54 112.37 1029.6 114.39 1025.9 118.41 1022.22 122.45 1020.36 128.09 1020.36 135.33v54.76H998.04V133.27C998.04 126.71 996.4 121.59 993.12 117.89 989.84 114.21 985.3 112.35 979.48 112.35 973.3 112.35 968.32 114.37 964.58 118.39S958.96 128.07 958.96 135.31v54.76H936.28V95.39h21.1L958.14 104.49C963.64 96.43 972.6 92.39 985.04 92.39 992.28 92.39 998.58 93.89 1003.88 96.89 1009.2 99.89 1013.22 104.27 1015.98 110.01 1018.3 104.51 1022.12 100.19 1027.46 97.07 1032.8 93.95 1039.16 92.39 1046.54 92.39 1057.28 92.39 1065.82 95.71 1072.14 102.33 1078.46 108.95 1081.6 118.11 1081.6 129.79V129.83z"></path><path d="M1193.54 151.11h-72.56C1121.74 158.23 1124.42 163.67 1129.04 167.43 1133.66 171.19 1139.54 173.05 1146.66 173.05 1158.22 173.05 1166.32 168.23 1170.94 158.61L1189.88 166.11C1186.32 174.43 1180.7 180.93 1173.06 185.61 1165.4 190.29 1156.6 192.65 1146.66 192.65 1132.66 192.65 1121.3 188.07 1112.58 178.91S1099.5 157.73 1099.5 142.87C1099.5 128.01 1103.9 115.91 1112.68 106.59 1121.46 97.27 1132.94 92.63 1147.14 92.63 1161.34 92.63 1172.3 97.23 1180.8 106.41 1189.3 115.59 1193.56 127.69 1193.56 142.69v8.44L1193.54 151.11zM1121.36 135.17H1170.48C1170.04 127.49 1167.72 121.63 1163.5 117.59 1159.28 113.55 1153.6 111.55 1146.48 111.55 1139.36 111.55 1133.66 113.59 1129.24 117.69 1124.8 121.79 1122.18 127.61 1121.36 135.17z"></path></g></svg>


## 安装

主要安装过程可以参考如下文章：

+ [Getting Started](https://esphome.io/guides/getting_started_hassio/)
+ [Install ESPHome Manually](https://esphome.io/guides/installing_esphome/)
+ [Install via Docker](https://esphome.io/guides/getting_started_command_line/)

一般情况下，考虑到Home Assistant设备(Yellow/Green)本身性能不是很强，所以更推荐使用`Install ESPHome Manually`来手动在本地安装ESPHome。在安装之前可以借助Python的Virtual Environments创建虚拟环境，之后激活虚拟环境将ESPHome安装至虚拟环境中，保证与其他环境隔离。

如果有自动化构建固件的需求，可以考虑使用docker镜像进行自动化部署。

## 迁移指南

ESPHome本身是由一个个组件组成的，为了方便Home Assistant集成，其采用了比较方便的YAML声明方式编写配置文件。用户可以使用YAML配置非常简单的描述设备的总线，外设，然后添加组件，最终集成至Home Assistant中。

+ [ESPHome Components](https://esphome.io/components/)

同时，ESPHome支持拓展自定义组件（external components），对于官方没有支持的组件，可以通过这种自定义组件的方式来扩展。

+ [External Components](https://esphome.io/components/external_components/)
+ [Starter Components](https://github.com/esphome/starter-components) 提供了一个参考，如何从头开始编写ESPHome组件

::: tip
熟悉Arduino/ESP-IDF框架对于上手external component非常有帮助，在编写组件的过程中，会发现C/C++框架和Arduino的`setup`, `loop`非常类似。
:::

## 固件上传/调试

最通用的办法还是串口上传/调试，ESPHome Web提供了一上功能：

+ [ESPHome Web](https://web.esphome.io/?dashboard_logs)

如果需要获取更加详细的日志，可以调整`logger`中的level:

+ [ESPHome Component logger](https://esphome.io/components/logger/)